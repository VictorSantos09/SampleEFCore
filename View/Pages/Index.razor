@page "/"

<PageTitle>Index</PageTitle>

@using System.Net.Http.Json
@inject PeopleMoviesService _service
@inject IDialogService _dialogService

<MudButton Class="mb-5" Color="Color.Primary" Variant="Variant.Filled" OnClick="() => OpenAddDialog()">
    <MudIcon Icon="@Icons.Material.Filled.Add" />
    Adicionar
</MudButton>

<MudDataGrid Items="@Elements" Filterable="true" FilterMode="@_filterMode" FilterCaseSensitivity="@_caseSensitivity">
    <Columns>
        <PropertyColumn Property="x => x.Date" Title="Data Comparecimento" Filterable="true" />
        <PropertyColumn Property="x => x.Movie.Title"  Title="Filme" Filterable="true"/>
        <PropertyColumn Property="x => x.Movie.Genre.Name" Title="Gênero" Filterable="true"/>
        <PropertyColumn Property="x => x.Person.FullName" Title="Pessoa" Filterable="true" />
    </Columns>
    <PagerContent>
        <MudDataGridPager T="PeopleMoviesModel" />
    </PagerContent>
</MudDataGrid>


@code {
    IEnumerable<PeopleMoviesModel> Elements = new List<PeopleMoviesModel>();
    DataGridFilterMode _filterMode = DataGridFilterMode.Simple;
    DataGridFilterCaseSensitivity _caseSensitivity = DataGridFilterCaseSensitivity.CaseInsensitive;

    protected override async Task OnInitializedAsync()
    {
        Elements = await _service.GetAllAsync();
    }

    private void OpenAddDialog()
    {
        DialogOptions options = new() { CloseButton = true };
        _dialogService.Show(typeof(WatchMovieDialog), "Assitir Filme", options);
    }
}