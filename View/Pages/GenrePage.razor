@page "/genre"
@inject GenreService _service
@inject IDialogService _dialogService

@if (_genres.Any())
{
    <MudTable Items="@_genres" Hover="true" Breakpoint="Breakpoint.Sm" Loading="@_isLoading" LoadingProgressColor="Color.Info">
        <HeaderContent>
            <MudTh>Nome</MudTh>
            <MudTh>Remover</MudTh>
            <MudTh>Editar</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Nome">
                @context.Name
            </MudTd>
            <MudTd DataLabel="Remover">
                <MudIconButton @onclick="() => Delete(context.Id)" Icon="@Icons.Filled.Delete"></MudIconButton>
            </MudTd>
            <MudTd DataLabel="Editar">
                <MudIconButton @onclick="() => OpenEditDialog(context.Id, context.Name)" Icon="@Icons.Filled.Edit"></MudIconButton>
            </MudTd>
        </RowTemplate>
    </MudTable>

    <MudButton Class="mt-5" Color="Color.Primary" Variant="Variant.Filled" OnClick="() => OpenAddDialog()">
        <MudIcon Icon="@Icons.Material.Filled.Add" />
        Adicionar
    </MudButton>
}
else
{
    <MudAlert Severity="Severity.Info">Nenhum gênero cadastrado</MudAlert>
}

@code {
    private IEnumerable<GenreModel> _genres = new List<GenreModel>();
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        _genres = await _service.GetAllAsync();
        _isLoading = false;
    }

    private async Task Delete(int id)
    {
        await _service.DeleteAsync(id);
        await OnInitializedAsync();
    }

    private void OpenAddDialog()
    {
        DialogOptions options = new DialogOptions() { CloseButton = true };
        _dialogService.Show<AddGenreDialog>("Adicionar Gênero", options);
    }

    private void OpenEditDialog(int id, string genreName)
    {
        DialogOptions options = new DialogOptions() { CloseButton = true };

        DialogParameters parameters = new();
        parameters.Add("Id", id);
        parameters.Add("GenreName", genreName);

        _dialogService.Show(typeof(EditGenreDialog), "Editar Gênero", parameters, options);
    }
}
